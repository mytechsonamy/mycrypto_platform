# ============================================================================
# Wallet Service Environment Configuration
# ============================================================================
# This file contains all environment variables required by the wallet service.
# Copy this file to .env and update with your actual values.
#
# SECURITY: Never commit .env file to version control!
# ============================================================================

# ----------------------------------------------------------------------------
# Application Configuration
# ----------------------------------------------------------------------------

# Environment: development | staging | production
NODE_ENV=development

# Port number the service listens on
# Default: 3002 (auth-service uses 3001)
PORT=3002

# Logging level: debug | info | warn | error
# Use 'debug' for development, 'info' for production
LOG_LEVEL=debug

# ----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# ----------------------------------------------------------------------------

# Full PostgreSQL connection string (preferred method)
# Format: postgresql://username:password@host:port/database
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/exchange_dev

# Alternative: Individual connection parameters
# (DATABASE_URL takes precedence if both are provided)
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=your_password
DATABASE_NAME=wallet_db

# Connection pool settings (optional)
# DATABASE_POOL_MIN=2
# DATABASE_POOL_MAX=10

# ----------------------------------------------------------------------------
# Redis Configuration (Caching & Session Storage)
# ----------------------------------------------------------------------------

# Redis server host
REDIS_HOST=localhost

# Redis server port
REDIS_PORT=6379

# Redis password (leave empty if no password)
REDIS_PASSWORD=redis_dev_password

# Redis database number (0-15)
# REDIS_DB=0

# Redis connection timeout in milliseconds
# REDIS_TIMEOUT=5000

# ----------------------------------------------------------------------------
# RabbitMQ Configuration (Message Queue - Optional for Sprint 2)
# ----------------------------------------------------------------------------

# RabbitMQ connection URL
# Format: amqp://username:password@host:port
RABBITMQ_URL=amqp://rabbitmq:rabbitmq_dev_password@localhost:5672

# RabbitMQ queue name for wallet notifications
RABBITMQ_QUEUE=wallet_notifications

# NOTE: RabbitMQ infrastructure is ready but integration is deferred to Sprint 3
# It will be used for:
# - Deposit approval notifications
# - Withdrawal status notifications
# - Admin alerts

# ----------------------------------------------------------------------------
# JWT Configuration (Authentication)
# ----------------------------------------------------------------------------

# IMPORTANT: Wallet service uses RS256 (asymmetric) algorithm
# It only needs the PUBLIC KEY from auth-service for token verification
# NEVER use the private key here!

# JWT algorithm: MUST be RS256 (do not change)
JWT_ALGORITHM=RS256

# Path to JWT public key file (shared from auth-service)
# For Docker: /app/keys/public.pem
# For local dev: ../auth-service/keys/public.pem
JWT_PUBLIC_KEY_PATH=../auth-service/keys/public.pem

# JWT_SECRET is NOT used for RS256 (only for HS256)
# Keeping this line for backward compatibility, but it's ignored
# JWT_SECRET=not_used_with_rs256

# Token expiration validation (in seconds)
# JWT_MAX_AGE=900

# ----------------------------------------------------------------------------
# Rate Limiting Configuration
# ----------------------------------------------------------------------------

# Rate limit time window in milliseconds
# Default: 60000 (60 seconds)
RATE_LIMIT_TTL=60000

# Maximum requests per time window per user
# Default: 100 requests per minute
RATE_LIMIT_MAX=100

# Custom rate limits for specific endpoints (optional):
# Withdrawal endpoint: 5 requests per minute (prevents 2FA brute-force)
# WITHDRAWAL_RATE_LIMIT=5
# Bank account operations: 5-10 requests per minute
# BANK_ACCOUNT_RATE_LIMIT=10

# ----------------------------------------------------------------------------
# Wallet & Balance Configuration
# ----------------------------------------------------------------------------

# Balance cache TTL in seconds
# How long to cache balance queries in Redis
# Default: 5 seconds (as per requirements)
BALANCE_CACHE_TTL=5

# Withdrawal lock duration in seconds
# How long to lock balance during withdrawal processing
# Default: 300 seconds (5 minutes)
WITHDRAWAL_LOCK_TTL=300

# ----------------------------------------------------------------------------
# TRY (Turkish Lira) Limits & Fees
# ----------------------------------------------------------------------------

# Minimum TRY deposit amount
TRY_MIN_DEPOSIT=100

# Maximum TRY deposit amount per transaction
TRY_MAX_DEPOSIT=50000

# Minimum TRY withdrawal amount
TRY_MIN_WITHDRAWAL=50

# Maximum TRY withdrawal amount per transaction
TRY_MAX_WITHDRAWAL=50000

# Flat withdrawal fee in TRY
TRY_WITHDRAWAL_FEE=5

# Daily withdrawal limit (number of withdrawals per day)
# NOTE: Implementation pending (Sprint 3)
WITHDRAWAL_DAILY_LIMIT=5

# Daily deposit limit in TRY (total amount per day)
# NOTE: Implementation pending (Sprint 3)
# TRY_DAILY_DEPOSIT_LIMIT=50000

# ----------------------------------------------------------------------------
# Virtual IBAN Configuration (for TRY Deposits)
# ----------------------------------------------------------------------------

# Virtual IBAN for receiving TRY deposits
# Format: TR followed by 24 digits (Turkish IBAN format)
# This IBAN is displayed to users for making deposits
VIRTUAL_IBAN=TR330006100519786457841326

# Bank name for virtual IBAN (optional, for display purposes)
# VIRTUAL_IBAN_BANK_NAME=Ziraat BankasÄ±

# Account holder name for virtual IBAN (optional)
# VIRTUAL_IBAN_HOLDER=MyCrypto Platform

# ----------------------------------------------------------------------------
# Auth Service Integration (for 2FA Verification)
# ----------------------------------------------------------------------------

# Auth service base URL (used for 2FA code verification)
# For Docker: http://auth-service:3001
# For local dev: http://localhost:3001
AUTH_SERVICE_URL=http://auth-service:3001

# Auth service API timeout in milliseconds
# AUTH_SERVICE_TIMEOUT=5000

# ----------------------------------------------------------------------------
# Monitoring & Observability (Optional)
# ----------------------------------------------------------------------------

# Enable Prometheus metrics endpoint
# PROMETHEUS_ENABLED=false

# Prometheus metrics port
# PROMETHEUS_PORT=9090

# Enable structured logging (JSON format)
# STRUCTURED_LOGGING=true

# Sentry DSN for error tracking (optional)
# SENTRY_DSN=

# ----------------------------------------------------------------------------
# Feature Flags (Optional)
# ----------------------------------------------------------------------------

# Enable WebSocket for real-time balance updates
# NOTE: Implementation pending (Sprint 3)
# WEBSOCKET_ENABLED=false

# Enable crypto deposits/withdrawals
# NOTE: Implemented in Sprint 3
CRYPTO_ENABLED=true

# Enable admin panel endpoints
# ADMIN_PANEL_ENABLED=false

# ----------------------------------------------------------------------------
# Development & Testing
# ----------------------------------------------------------------------------

# Skip database migrations on startup (useful for testing)
# SKIP_MIGRATIONS=false

# Seed database with test data on startup
# SEED_DATABASE=false

# Mock external services (for testing)
# MOCK_AUTH_SERVICE=false
# MOCK_BANK_API=false

# ----------------------------------------------------------------------------
# Crypto Deposit Configuration (Story 2.4 - Sprint 3)
# ----------------------------------------------------------------------------

# HD Wallet Mnemonic (BIP-39)
# CRITICAL: This is your master seed for generating all crypto addresses
# NEVER share this mnemonic or commit it to version control!
# Generate one using: node -e "console.log(require('bip39').generateMnemonic(256))"
# Must be 24 words (256-bit entropy) for maximum security
HD_WALLET_MNEMONIC=your_24_word_mnemonic_phrase_here_replace_with_actual_generated_mnemonic_never_share_this_seed_phrase_keep_secure_backup

# BlockCypher API Token
# Get free token at: https://www.blockcypher.com/
# Free tier: 200 requests/hour, 3 requests/second
# Paid tier recommended for production
BLOCKCYPHER_API_TOKEN=your_blockcypher_api_token_here

# BlockCypher Webhook URL
# URL where BlockCypher sends transaction notifications
# For production: https://yourdomain.com/wallet/deposit/crypto/webhook?token=YOUR_WEBHOOK_TOKEN
# For development: Use ngrok or similar tunneling service
BLOCKCYPHER_WEBHOOK_URL=https://api.mycrypto-platform.com/wallet/deposit/crypto/webhook

# Webhook Security Token
# CRITICAL: Generate a strong random token for webhook validation
# This prevents unauthorized webhook calls
# Generate with: openssl rand -hex 32
BLOCKCYPHER_WEBHOOK_TOKEN=your_webhook_security_token_here

# Crypto Deposit Limits (in crypto units)
# BTC minimum deposit (in BTC)
BTC_MIN_DEPOSIT=0.0001

# ETH minimum deposit (in ETH)
ETH_MIN_DEPOSIT=0.001

# USDT minimum deposit (in USDT)
USDT_MIN_DEPOSIT=1.0

# ============================================================================
# End of Configuration
# ============================================================================
#
# For production deployment:
# 1. Set NODE_ENV=production
# 2. Use strong DATABASE_PASSWORD
# 3. Use strong REDIS_PASSWORD
# 4. Set LOG_LEVEL=warn
# 5. Ensure JWT_PUBLIC_KEY_PATH points to correct location
# 6. Update VIRTUAL_IBAN with real bank account
# 7. Review and adjust all limits/fees
# 8. Enable monitoring (Prometheus, Sentry)
#
# For more information, see:
# - README.md
# - /docs/STANDARDIZED_SPRINT_PROCESS.md
# - /QA_TestPlans/Sprint2/SPRINT2_ARCHITECTURAL_REVIEW_REPORT.md
# ============================================================================
