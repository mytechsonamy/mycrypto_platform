# ============================================================================
# Wallet Service Environment Configuration
# ============================================================================
# This file contains all environment variables required by the wallet service.
# Copy this file to .env and update with your actual values.
#
# SECURITY: Never commit .env file to version control!
# ============================================================================

# ----------------------------------------------------------------------------
# Application Configuration
# ----------------------------------------------------------------------------

# Environment: development | staging | production
NODE_ENV=development

# Port number the service listens on
# Default: 3002 (auth-service uses 3001)
PORT=3002

# Logging level: debug | info | warn | error
# Use 'debug' for development, 'info' for production
LOG_LEVEL=debug

# ----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# ----------------------------------------------------------------------------

# Full PostgreSQL connection string (preferred method)
# Format: postgresql://username:password@host:port/database
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/exchange_dev

# Alternative: Individual connection parameters
# (DATABASE_URL takes precedence if both are provided)
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=your_password
DATABASE_NAME=wallet_db

# Connection pool settings (optional)
# DATABASE_POOL_MIN=2
# DATABASE_POOL_MAX=10

# ----------------------------------------------------------------------------
# Redis Configuration (Caching & Session Storage)
# ----------------------------------------------------------------------------

# Redis server host
REDIS_HOST=localhost

# Redis server port
REDIS_PORT=6379

# Redis password (leave empty if no password)
REDIS_PASSWORD=redis_dev_password

# Redis database number (0-15)
# REDIS_DB=0

# Redis connection timeout in milliseconds
# REDIS_TIMEOUT=5000

# ----------------------------------------------------------------------------
# RabbitMQ Configuration (Message Queue - Optional for Sprint 2)
# ----------------------------------------------------------------------------

# RabbitMQ connection URL
# Format: amqp://username:password@host:port
RABBITMQ_URL=amqp://rabbitmq:rabbitmq_dev_password@localhost:5672

# RabbitMQ queue name for wallet notifications
RABBITMQ_QUEUE=wallet_notifications

# NOTE: RabbitMQ infrastructure is ready but integration is deferred to Sprint 3
# It will be used for:
# - Deposit approval notifications
# - Withdrawal status notifications
# - Admin alerts

# ----------------------------------------------------------------------------
# JWT Configuration (Authentication)
# ----------------------------------------------------------------------------

# IMPORTANT: Wallet service uses RS256 (asymmetric) algorithm
# It only needs the PUBLIC KEY from auth-service for token verification
# NEVER use the private key here!

# JWT algorithm: MUST be RS256 (do not change)
JWT_ALGORITHM=RS256

# Path to JWT public key file (shared from auth-service)
# For Docker: /app/keys/public.pem
# For local dev: ../auth-service/keys/public.pem
JWT_PUBLIC_KEY_PATH=../auth-service/keys/public.pem

# JWT_SECRET is NOT used for RS256 (only for HS256)
# Keeping this line for backward compatibility, but it's ignored
# JWT_SECRET=not_used_with_rs256

# Token expiration validation (in seconds)
# JWT_MAX_AGE=900

# ----------------------------------------------------------------------------
# Rate Limiting Configuration
# ----------------------------------------------------------------------------

# Rate limit time window in milliseconds
# Default: 60000 (60 seconds)
RATE_LIMIT_TTL=60000

# Maximum requests per time window per user
# Default: 100 requests per minute
RATE_LIMIT_MAX=100

# Custom rate limits for specific endpoints (optional):
# Withdrawal endpoint: 5 requests per minute (prevents 2FA brute-force)
# WITHDRAWAL_RATE_LIMIT=5
# Bank account operations: 5-10 requests per minute
# BANK_ACCOUNT_RATE_LIMIT=10

# ----------------------------------------------------------------------------
# Wallet & Balance Configuration
# ----------------------------------------------------------------------------

# Balance cache TTL in seconds
# How long to cache balance queries in Redis
# Default: 5 seconds (as per requirements)
BALANCE_CACHE_TTL=5

# Withdrawal lock duration in seconds
# How long to lock balance during withdrawal processing
# Default: 300 seconds (5 minutes)
WITHDRAWAL_LOCK_TTL=300

# ----------------------------------------------------------------------------
# TRY (Turkish Lira) Limits & Fees
# ----------------------------------------------------------------------------

# Minimum TRY deposit amount
TRY_MIN_DEPOSIT=100

# Maximum TRY deposit amount per transaction
TRY_MAX_DEPOSIT=50000

# Minimum TRY withdrawal amount
TRY_MIN_WITHDRAWAL=50

# Maximum TRY withdrawal amount per transaction
TRY_MAX_WITHDRAWAL=50000

# Flat withdrawal fee in TRY
TRY_WITHDRAWAL_FEE=5

# Daily withdrawal limit (number of withdrawals per day)
# NOTE: Implementation pending (Sprint 3)
WITHDRAWAL_DAILY_LIMIT=5

# Daily deposit limit in TRY (total amount per day)
# NOTE: Implementation pending (Sprint 3)
# TRY_DAILY_DEPOSIT_LIMIT=50000

# ----------------------------------------------------------------------------
# Virtual IBAN Configuration (for TRY Deposits)
# ----------------------------------------------------------------------------

# Virtual IBAN for receiving TRY deposits
# Format: TR followed by 24 digits (Turkish IBAN format)
# This IBAN is displayed to users for making deposits
VIRTUAL_IBAN=TR330006100519786457841326

# Bank name for virtual IBAN (optional, for display purposes)
# VIRTUAL_IBAN_BANK_NAME=Ziraat BankasÄ±

# Account holder name for virtual IBAN (optional)
# VIRTUAL_IBAN_HOLDER=MyCrypto Platform

# ----------------------------------------------------------------------------
# Auth Service Integration (for 2FA Verification)
# ----------------------------------------------------------------------------

# Auth service base URL (used for 2FA code verification)
# For Docker: http://auth-service:3001
# For local dev: http://localhost:3001
AUTH_SERVICE_URL=http://auth-service:3001

# Auth service API timeout in milliseconds
# AUTH_SERVICE_TIMEOUT=5000

# ----------------------------------------------------------------------------
# Monitoring & Observability (Optional)
# ----------------------------------------------------------------------------

# Enable Prometheus metrics endpoint
# PROMETHEUS_ENABLED=false

# Prometheus metrics port
# PROMETHEUS_PORT=9090

# Enable structured logging (JSON format)
# STRUCTURED_LOGGING=true

# Sentry DSN for error tracking (optional)
# SENTRY_DSN=

# ----------------------------------------------------------------------------
# Feature Flags (Optional)
# ----------------------------------------------------------------------------

# Enable WebSocket for real-time balance updates
# NOTE: Implementation pending (Sprint 3)
# WEBSOCKET_ENABLED=false

# Enable crypto deposits/withdrawals
# NOTE: Implemented in Sprint 3
CRYPTO_ENABLED=true

# Enable admin panel endpoints
# ADMIN_PANEL_ENABLED=false

# ----------------------------------------------------------------------------
# Development & Testing
# ----------------------------------------------------------------------------

# Skip database migrations on startup (useful for testing)
# SKIP_MIGRATIONS=false

# Seed database with test data on startup
# SEED_DATABASE=false

# Mock external services (for testing)
# MOCK_AUTH_SERVICE=false
# MOCK_BANK_API=false

# ----------------------------------------------------------------------------
# Crypto Deposit Configuration (Story 2.4 - Sprint 3)
# ----------------------------------------------------------------------------

# HD Wallet Mnemonic (BIP-39)
# CRITICAL: This is your master seed for generating all crypto addresses
# NEVER share this mnemonic or commit it to version control!
# Generate one using: node -e "console.log(require('bip39').generateMnemonic(256))"
# Must be 24 words (256-bit entropy) for maximum security
HD_WALLET_MNEMONIC=your_24_word_mnemonic_phrase_here_replace_with_actual_generated_mnemonic_never_share_this_seed_phrase_keep_secure_backup

# BlockCypher API Token
# Get free token at: https://www.blockcypher.com/
# Free tier: 200 requests/hour, 3 requests/second
# Paid tier recommended for production
BLOCKCYPHER_API_TOKEN=your_blockcypher_api_token_here

# BlockCypher Webhook URL
# URL where BlockCypher sends transaction notifications
# For production: https://yourdomain.com/wallet/deposit/crypto/webhook?token=YOUR_WEBHOOK_TOKEN
# For development: Use ngrok or similar tunneling service
BLOCKCYPHER_WEBHOOK_URL=https://api.mycrypto-platform.com/wallet/deposit/crypto/webhook

# Webhook Security Token
# CRITICAL: Generate a strong random token for webhook validation
# This prevents unauthorized webhook calls
# Generate with: openssl rand -hex 32
BLOCKCYPHER_WEBHOOK_TOKEN=your_webhook_security_token_here

# Crypto Deposit Limits (in crypto units)
# BTC minimum deposit (in BTC)
BTC_MIN_DEPOSIT=0.0001

# ETH minimum deposit (in ETH)
ETH_MIN_DEPOSIT=0.001

# USDT minimum deposit (in USDT)
USDT_MIN_DEPOSIT=1.0

# ----------------------------------------------------------------------------
# Crypto Withdrawal Configuration (Story 2.5 - Sprint 3 Day 3)
# ----------------------------------------------------------------------------

# Hot Wallet Private Keys
# CRITICAL: These are ENCRYPTED private keys for hot wallets
# PRODUCTION: Use Hardware Security Module (HSM) or AWS KMS
# NEVER commit real private keys to version control!
# These keys should be AES-256 encrypted at rest

# BTC Hot Wallet Private Key (WIF format, encrypted)
# Generate testnet key: node -e "const bitcoin = require('bitcoinjs-lib'); const keyPair = bitcoin.ECPair.makeRandom({network: bitcoin.networks.testnet}); console.log(keyPair.toWIF());"
BTC_HOT_WALLET_PRIVATE_KEY=your_encrypted_btc_private_key_here

# ETH Hot Wallet Private Key (hex format, encrypted)
# Generate testnet key: node -e "const { Wallet } = require('ethers'); const wallet = Wallet.createRandom(); console.log(wallet.privateKey);"
ETH_HOT_WALLET_PRIVATE_KEY=your_encrypted_eth_private_key_here

# USDT Hot Wallet Private Key (same as ETH for ERC20, hex format)
# For TRC20, use TRON private key
USDT_HOT_WALLET_PRIVATE_KEY=your_encrypted_usdt_private_key_here

# Private Key Encryption Passphrase
# Used to decrypt private keys at runtime
# Generate with: openssl rand -base64 32
WALLET_ENCRYPTION_KEY=your_encryption_passphrase_here

# Blockchain API Configuration
# BlockCypher (Bitcoin)
# Already defined above for deposits, reused for withdrawals
# BLOCKCYPHER_API_TOKEN=your_blockcypher_api_token_here

# Infura (Ethereum)
# Get project ID at: https://infura.io/
# Free tier: 100k requests/day
INFURA_PROJECT_ID=your_infura_project_id_here
INFURA_PROJECT_SECRET=your_infura_project_secret_here

# Alchemy (Ethereum - Alternative)
# Get API key at: https://www.alchemy.com/
# Free tier: 300M compute units/month
ALCHEMY_API_KEY=your_alchemy_api_key_here

# TronGrid (TRON for TRC20 USDT)
# Get API key at: https://www.trongrid.io/
# Free tier available
TRONGRID_API_KEY=your_trongrid_api_key_here

# Network Configuration
# Options: testnet | mainnet
BITCOIN_NETWORK=testnet
ETHEREUM_NETWORK=sepolia
TRON_NETWORK=shasta

# Blockchain Confirmation Requirements
# Number of confirmations before marking transaction as completed
BTC_CONFIRMATION_COUNT=3
ETH_CONFIRMATION_COUNT=12
USDT_CONFIRMATION_COUNT=12
USDT_TRC20_CONFIRMATION_COUNT=19

# Crypto Withdrawal Limits (in crypto units)
# BTC withdrawal limits
BTC_MIN_WITHDRAWAL=0.001
BTC_MAX_WITHDRAWAL=10.0

# ETH withdrawal limits
ETH_MIN_WITHDRAWAL=0.01
ETH_MAX_WITHDRAWAL=100.0

# USDT withdrawal limits
USDT_MIN_WITHDRAWAL=10.0
USDT_MAX_WITHDRAWAL=100000.0

# Platform Fees (fixed amounts in crypto)
BTC_PLATFORM_FEE=0.0005
ETH_PLATFORM_FEE=0.005
USDT_PLATFORM_FEE=1.0

# Network Fee Buffers (multiplier for estimated fees)
# 1.2 = 20% buffer above estimated fee
BTC_FEE_BUFFER=1.2
ETH_FEE_BUFFER=1.3
USDT_FEE_BUFFER=1.3

# 2FA Configuration for Withdrawals
# Require 2FA code for all withdrawals
TWO_FA_REQUIRED=true

# Maximum 2FA verification attempts
TWO_FA_MAX_ATTEMPTS=5

# 2FA attempt window in minutes
TWO_FA_ATTEMPT_WINDOW_MINUTES=5

# Allow withdrawal if auth-service is down (NOT recommended for production)
TWO_FA_ALLOW_ON_SERVICE_FAILURE=false

# Admin Approval Configuration
# Withdrawals above this USD value require admin approval
WITHDRAWAL_ADMIN_APPROVAL_THRESHOLD=10000

# Auto-approve withdrawals below threshold
WITHDRAWAL_AUTO_APPROVE=true

# Withdrawal Processing Configuration
# Enable automatic withdrawal processing
WITHDRAWAL_PROCESSING_ENABLED=true

# Background job interval for checking withdrawal statuses (ms)
# Default: 120000 (2 minutes)
WITHDRAWAL_STATUS_CHECK_INTERVAL=120000

# Maximum retry attempts for failed broadcasts
WITHDRAWAL_MAX_RETRIES=3

# Delay between retries in milliseconds
WITHDRAWAL_RETRY_DELAY=5000

# Transaction timeout in seconds
WITHDRAWAL_TX_TIMEOUT=300

# Hot/Cold Wallet Configuration (Future)
# Threshold for moving funds to cold storage (in USD)
# HOT_WALLET_THRESHOLD=100000

# Multi-signature Configuration (Future)
# Number of signatures required for cold wallet withdrawals
# MULTISIG_REQUIRED_SIGNATURES=3
# MULTISIG_TOTAL_SIGNERS=5

# Gas Price Configuration (Ethereum)
# Gas price strategy: low | medium | high | custom
ETH_GAS_PRICE_STRATEGY=medium

# Custom gas price in Gwei (if strategy=custom)
# ETH_CUSTOM_GAS_PRICE=50

# Max gas price willing to pay (Gwei) - prevents overpaying during spikes
ETH_MAX_GAS_PRICE=200

# Gas limit for standard ETH transfer
ETH_GAS_LIMIT=21000

# Gas limit for ERC20 token transfer
ERC20_GAS_LIMIT=65000

# Bitcoin Fee Configuration
# Fee rate strategy: economy | standard | priority
BTC_FEE_STRATEGY=standard

# Custom fee rate in satoshis per byte (if strategy=custom)
# BTC_CUSTOM_FEE_RATE=10

# Max fee rate willing to pay (sat/byte)
BTC_MAX_FEE_RATE=100

# ============================================================================
# End of Configuration
# ============================================================================
#
# For production deployment:
# 1. Set NODE_ENV=production
# 2. Use strong DATABASE_PASSWORD
# 3. Use strong REDIS_PASSWORD
# 4. Set LOG_LEVEL=warn
# 5. Ensure JWT_PUBLIC_KEY_PATH points to correct location
# 6. Update VIRTUAL_IBAN with real bank account
# 7. Review and adjust all limits/fees
# 8. Enable monitoring (Prometheus, Sentry)
#
# For more information, see:
# - README.md
# - /docs/STANDARDIZED_SPRINT_PROCESS.md
# - /QA_TestPlans/Sprint2/SPRINT2_ARCHITECTURAL_REVIEW_REPORT.md
# ============================================================================
